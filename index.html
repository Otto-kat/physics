<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>è½»ç®€ç¤ºä¾‹ â€” äº‘ç«¯è¯„è®ºä¸æ–‡ä»¶ä¸Šä¼ ï¼ˆFirebaseç‰ˆï¼‰</title>
    <style>
        /* ä¿ç•™åŸæ ·å¼ */
        :root {
            --bg: #f6f8fb;
            --card: #fff;
            --text: #0f1720;
            --muted: #6b7280;
            --accent: #2563eb;
            --accent-contrast: #fff;
            --radius: 12px;
            --shadow: 0 6px 20px rgba(15,23,40,0.06)
        }

        [data-theme="dark"] {
            --bg: #071126;
            --card: #071828;
            --text: #e6eef8;
            --muted: #9fb2d1;
            --accent: #60a5fa;
            --accent-contrast: #001028;
            --shadow: 0 8px 26px rgba(0,0,0,0.6)
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: Inter,"Microsoft YaHei",system-ui,Arial;
            background: var(--bg);
            color: var(--text)
        }

        .wrap {
            max-width: 980px;
            margin: 28px auto;
            padding: 16px
        }

        header {
            display: flex;
            align-items: center;
            gap: 14px
        }

        .logo {
            width: 48px;
            height: 48px;
            display: grid;
            place-items: center;
            border-radius: 10px;
            background: linear-gradient(135deg,var(--accent),#0ea5e9);
            color: var(--accent-contrast);
            font-weight: 700
        }

        h1 {
            font-size: 18px;
            margin: 0
        }

        p.lead {
            margin: 4px 0 0;
            color: var(--muted);
            font-size: 14px
        }

        nav {
            margin-left: auto;
            display: flex;
            gap: 8px;
            align-items: center
        }

        .btn {
            background: var(--accent);
            color: var(--accent-contrast);
            padding: 8px 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600
        }

        .ghost {
            background: transparent;
            border: 1px solid rgba(0,0,0,0.06);
            padding: 8px 10px;
            border-radius: 10px
        }

        main {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 18px;
            margin-top: 18px
        }

        @media(max-width:980px) {
            main {
                grid-template-columns: 1fr
            }
        }

        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow)
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 12px
        }

        .comment {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            background: linear-gradient(180deg,rgba(0,0,0,0.01),transparent)
        }

        .avatar {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background: linear-gradient(135deg,#e2e8f0,#c7d2fe);
            display: grid;
            place-items: center;
            font-weight: 700
        }

        .comment-body {
            flex: 1
        }

        .meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px
        }

        .small {
            font-size: 13px;
            color: var(--muted)
        }

        .file-link {
            display: inline-block;
            margin-top: 6px;
            font-size: 13px;
            color: var(--accent);
            text-decoration: underline;
            cursor: pointer
        }
    </style>
</head>
<body data-theme="light">
    <div class="wrap">
        <header>
            <div class="logo">LN</div>
            <div>
                <h1 id="siteTitle">Firebase äº‘ç«¯è½»ç®€ç¤ºä¾‹</h1>
                <p class="lead">ä¸Šä¼  PDF/å›¾ç‰‡è¯„è®ºï¼Œå…¨ç½‘å¯è§</p>
            </div>
        </header>

        <main>
            <section class="card">
                <h3>ç•™è¨€åŒº</h3>
                <input id="cName" type="text" placeholder="åå­— (å¿…å¡«)" />
                <input id="cEmail" type="email" placeholder="é‚®ç®± (å¯é€‰)" />
                <textarea id="cText" placeholder="è¯„è®ºå†…å®¹ (å¿…å¡«)" style="width:100%;min-height:80px"></textarea>
                <input id="cFile" type="file" accept="application/pdf,image/png,image/jpeg" />
                <button class="btn" id="addComment">æäº¤è¯„è®º</button>
                <div id="uploadStatus" class="small muted" style="margin-top:6px"></div>
                <div class="comments-list" id="commentsContainer"></div>
            </section>
        </main>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-storage.js";

        // ä½ çš„ Firebase é…ç½®ï¼ˆä¿®æ”¹ storageBucket ä¸º .appspot.com ç»“å°¾ï¼‰
        const firebaseConfig = {
            apiKey: "AIzaSyCPDiyZtMUe_RNudnvXmaZGUfwhJjKVXOs",
            authDomain: "my-light-site.firebaseapp.com",
            projectId: "my-light-site",
            storageBucket: "my-light-site.appspot.com",
            messagingSenderId: "870998893975",
            appId: "1:870998893975:web:ce4b1d412168e07b5390d2",
            measurementId: "G-YEW0X7YB17"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        const addBtn = document.getElementById('addComment');
        const commentsContainer = document.getElementById('commentsContainer');
        const statusEl = document.getElementById('uploadStatus');

        async function renderComments() {
            commentsContainer.innerHTML = "<div class='small'>åŠ è½½ä¸­...</div>";
            const q = query(collection(db, "comments"), orderBy("ts", "desc"));
            const snap = await getDocs(q);
            commentsContainer.innerHTML = "";
            snap.forEach(doc => {
                const c = doc.data();
                const el = document.createElement('div');
                el.className = 'comment';
                el.innerHTML = `
              <div class="avatar">${(c.name || 'è®¿å®¢').slice(0, 2)}</div>
              <div class="comment-body">
                <div class="meta"><strong>${c.name || 'è®¿å®¢'}</strong><div class="small">${c.ts?.toDate ? c.ts.toDate().toLocaleString() : 'åˆšåˆš'}</div></div>
                <div style="margin-top:6px">${c.text || ''}</div>
                ${c.fileUrl ? `<a href="${c.fileUrl}" target="_blank" class="file-link">ğŸ“ ${c.fileName}</a>` : ''}
              </div>
            `;
                commentsContainer.appendChild(el);
            });
            if (!snap.size) commentsContainer.innerHTML = "<div class='small muted'>æš‚æ— è¯„è®º</div>";
        }

        addBtn.addEventListener('click', async () => {
            const name = document.getElementById('cName').value.trim();
            const email = document.getElementById('cEmail').value.trim();
            const text = document.getElementById('cText').value.trim();
            const fileInput = document.getElementById('cFile');
            if (!name || !text) { alert("è¯·å¡«å†™åå­—å’Œè¯„è®ºå†…å®¹"); return; }

            statusEl.textContent = "æ­£åœ¨ä¸Šä¼ ...";
            let fileUrl = '', fileName = '';
            const file = fileInput.files[0];
            if (file) {
                fileName = file.name;
                const fileRef = ref(storage, 'uploads/' + Date.now() + '_' + file.name);
                await uploadBytes(fileRef, file);
                fileUrl = await getDownloadURL(fileRef);
            }

            await addDoc(collection(db, "comments"), {
                name, email, text, fileUrl, fileName, ts: serverTimestamp()
            });

            statusEl.textContent = "âœ… å·²ä¸Šä¼ ";
            fileInput.value = ''; document.getElementById('cText').value = '';
            renderComments();
        });

        renderComments();
    </script>
</body>
</html>
