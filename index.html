<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>è½»ç®€ç¤ºä¾‹ â€” å¯ä¸Šä¼ è¯„è®ºä¸æ–‡ä»¶ã€å¯ç¼–è¾‘ã€æ˜“éƒ¨ç½²</title>
    <style>
        :root {
            --bg: #f6f8fb;
            --card: #fff;
            --text: #0f1720;
            --muted: #6b7280;
            --accent: #2563eb;
            --accent-contrast: #fff;
            --radius: 12px;
            --shadow: 0 6px 20px rgba(15,23,40,0.06)
        }

        [data-theme="dark"] {
            --bg: #071126;
            --card: #071828;
            --text: #e6eef8;
            --muted: #9fb2d1;
            --accent: #60a5fa;
            --accent-contrast: #001028;
            --shadow: 0 8px 26px rgba(0,0,0,0.6)
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: Inter, "Microsoft YaHei", system-ui, Arial;
            background: var(--bg);
            color: var(--text);
            -webkit-font-smoothing: antialiased
        }

        .wrap {
            max-width: 980px;
            margin: 28px auto;
            padding: 16px
        }

        header {
            display: flex;
            align-items: center;
            gap: 14px
        }

        .logo {
            width: 48px;
            height: 48px;
            display: grid;
            place-items: center;
            border-radius: 10px;
            background: linear-gradient(135deg,var(--accent),#0ea5e9);
            color: var(--accent-contrast);
            font-weight: 700
        }

        h1 {
            font-size: 18px;
            margin: 0
        }

        p.lead {
            margin: 4px 0 0;
            color: var(--muted);
            font-size: 14px
        }

        nav {
            margin-left: auto;
            display: flex;
            gap: 8px;
            align-items: center
        }

        .btn {
            background: var(--accent);
            color: var(--accent-contrast);
            padding: 8px 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600
        }

        .ghost {
            background: transparent;
            border: 1px solid rgba(0,0,0,0.06);
            padding: 8px 10px;
            border-radius: 10px
        }

        main {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 18px;
            margin-top: 18px
        }

        @media(max-width:980px) {
            main {
                grid-template-columns: 1fr
            }
        }

        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow)
        }

        /* editor area */
        .hero {
            display: flex;
            flex-direction: column;
            gap: 10px
        }

            .hero .intro {
                font-size: 15px;
                color: var(--muted)
            }

        .editable {
            padding: 10px;
            border-radius: 8px;
            border: 1px dashed rgba(0,0,0,0.04);
            min-height: 52px
        }

        .controls {
            display: flex;
            gap: 8px;
            align-items: center
        }

        /* comments */
        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 12px
        }

        .comment {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            background: linear-gradient(180deg,rgba(0,0,0,0.01),transparent)
        }

        .avatar {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background: linear-gradient(135deg,#e2e8f0,#c7d2fe);
            display: grid;
            place-items: center;
            font-weight: 700
        }

        .comment-body {
            flex: 1
        }

        .meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px
        }

        .small {
            font-size: 13px;
            color: var(--muted)
        }

        .file-link {
            display: inline-block;
            margin-top: 6px;
            font-size: 13px;
            color: var(--accent);
            text-decoration: underline;
            cursor: pointer
        }

        /* upload area */
        .uploader {
            display: flex;
            flex-direction: column;
            gap: 8px
        }

        input[type="text"], input[type="email"], textarea {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.06);
            outline: none
        }

        textarea {
            min-height: 88px;
            resize: vertical
        }

        label {
            font-size: 13px;
            color: var(--muted)
        }

        /* right column */
        .side h3 {
            margin: 0 0 10px 0
        }

        .side .note {
            font-size: 13px;
            color: var(--muted)
        }

        .files-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px
        }

        .file-thumb {
            padding: 8px;
            border-radius: 8px;
            background: linear-gradient(180deg,rgba(0,0,0,0.02),transparent);
            font-size: 13px
        }

        footer {
            margin-top: 24px;
            text-align: center;
            color: var(--muted);
            font-size: 13px
        }

        /* tiny utilities */
        .muted {
            color: var(--muted)
        }

        .flex {
            display: flex;
            gap: 8px;
            align-items: center
        }

        .actions {
            display: flex;
            gap: 6px
        }
    </style>
</head>
<body data-theme="light">
    <div class="wrap">
        <header>
            <div class="logo">LN</div>
            <div>
                <h1 contenteditable="true" id="siteTitle">æˆ‘çš„è½»ç®€ç«™ç‚¹ï¼ˆå¯ç¼–è¾‘ï¼‰</h1>
                <p class="lead">ä¸€ä¸ªå¯ä¸Šä¼ è¯„è®ºä¸æ–‡ä»¶ï¼ˆPDF/PNG/JPEGï¼‰ã€æ”¯æŒå‰ç«¯ç¼–è¾‘ä¸å¯¼å‡ºã€å¹¶èƒ½å¿«é€Ÿéƒ¨ç½²åˆ°é™æ€ä¸»æœºçš„å•é¡µç¤ºä¾‹</p>
            </div>

            <nav>
                <button class="ghost" id="editToggle">ç¼–è¾‘é¡µé¢</button>
                <button class="btn" id="deployTips">ä¸€é”®éƒ¨ç½²è¯´æ˜</button>
                <button class="btn" id="themeToggle">å¤œé—´</button>
            </nav>
        </header>

        <main>
            <section class="card hero">
                <div class="intro">é¡µé¢ç®€ä»‹ï¼ˆåŒå‡»å†…å®¹å³å¯ç¼–è¾‘ï¼‰ã€‚æˆ‘ä»¬ä¿ç•™æç®€é£æ ¼ï¼Œå‡å°‘å›¾ç‰‡ä»¥å‡å°é¡µé¢å™ªéŸ³ä¸å¸¦å®½ã€‚</div>

                <div>
                    <div class="controls">
                        <div style="flex:1">
                            <div class="editable" id="heroText" contenteditable="true">æ¬¢è¿ï¼åœ¨è¿™é‡Œè®¿å®¢å¯ä»¥ç•™ä¸‹å¸¦é™„ä»¶çš„è¯„è®ºï¼ˆPDF/PNG/JPEGï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸Šç¼–è¾‘æ–‡æœ¬ä¸æ ‡é¢˜ã€‚</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top:6px;display:flex;gap:8px">
                    <button class="btn" id="exportData">å¯¼å‡ºç«™ç‚¹æ•°æ®</button>
                    <button class="ghost" id="importDataBtn">å¯¼å…¥æ•°æ®</button>
                    <input id="importFile" type="file" accept="application/json" style="display:none" />
                </div>

                <hr style="border:none;border-top:1px solid rgba(0,0,0,0.04);margin:12px 0">

                <div class="card uploader" style="padding:12px">
                    <label class="small">åå­—</label>
                    <input id="cName" type="text" placeholder="ä½ çš„åå­— (å¿…å¡«)" />
                    <label class="small">é‚®ä»¶ï¼ˆä»…ç”¨äºç¤ºä¾‹ï¼‰</label>
                    <input id="cEmail" type="email" placeholder="example@domain.com" />
                    <label class="small">è¯„è®º</label>
                    <textarea id="cText" placeholder="ä½ çš„è¯„è®º... (å¿…å¡«)"></textarea>
                    <label class="small">é™„ä»¶ï¼ˆå¯é€‰ï¼‰ï¼šPDF / PNG / JPEGï¼ˆå•ä¸ªæ–‡ä»¶ï¼Œ<strong>å¤§äº 5MB è¯·å‹¿ä½¿ç”¨æœ¬åœ°å­˜å‚¨</strong>ï¼‰</label>
                    <input id="cFile" type="file" accept="application/pdf,image/png,image/jpeg" />
                    <div style="display:flex;gap:8px;align-items:center">
                        <button class="btn" id="addComment">æäº¤è¯„è®º</button>
                        <div class="muted" id="uploadHint">è¯„è®ºå°†ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼ˆä¹Ÿå¯å¯¼å‡ºä¸º JSONï¼‰ã€‚</div>
                    </div>
                </div>

                <div class="comments-list card" id="comments" style="margin-top:12px">
                    <h3 style="margin:0 0 8px 0">è®¿å®¢ç•™è¨€</h3>
                    <div id="commentsContainer"></div>
                </div>
            </section>

            <aside class="side">
                <div class="card">
                    <h3>ç«™ç‚¹è®¾ç½®</h3>
                    <div class="note">ä¸»é¢˜ã€å¯¼å‡ºä¸éƒ¨ç½²æç¤ºã€‚è‹¥æƒ³è®© "å…¨ä¸–ç•Œçœ‹è§"ï¼šå°†æ­¤é™æ€æ–‡ä»¶å¤¹å‘å¸ƒåˆ° GitHub Pages / Netlify / Vercelï¼ˆä¸‹æ–¹æœ‰è¯´æ˜ï¼‰ã€‚</div>
                    <hr style="margin:10px 0;border:none;border-top:1px solid rgba(0,0,0,0.04)">
                    <div style="margin-top:8px">
                        <label class="small">å½“å‰ä¸»é¢˜</label>
                        <div class="flex" style="margin-top:6px">
                            <button class="ghost" id="setLight">æ—¥é—´</button>
                            <button class="ghost" id="setDark">å¤œé—´</button>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top:12px">
                    <h3>å·²ä¸Šä¼ æ–‡ä»¶</h3>
                    <div class="files-grid" id="filesGrid"></div>
                </div>

                <div class="card" style="margin-top:12px">
                    <h3>å¿«é€Ÿè¯´æ˜</h3>
                    <ol style="padding-left:16px;font-size:13px;color:var(--muted)">
                        <li>è¯„è®ºä¸å°æ–‡ä»¶ä¿å­˜åœ¨æµè§ˆå™¨ localStorageï¼ˆç§æœ‰ï¼‰ã€‚</li>
                        <li>ç‚¹å‡»ã€Œå¯¼å‡ºç«™ç‚¹æ•°æ®ã€å¯ç”Ÿæˆ JSON å¤‡ä»½ï¼Œä¾¿äºè¿ç§»æˆ–ä¸Šä¼ è‡³æœåŠ¡å™¨ã€‚</li>
                        <li>è¦å…¬å¼€è®¿é—®ï¼Œè¯·éƒ¨ç½²åˆ°é™æ€ä¸»æœºï¼ˆGitHub Pages / Netlify / Vercelï¼‰ã€‚</li>
                    </ol>
                </div>
            </aside>
        </main>

        <footer>
            &copy; <span id="year"></span> è½»ç®€ç¤ºä¾‹ â€” å¯éƒ¨ç½²åˆ°é™æ€ä¸»æœº
        </footer>
    </div>

    <script>
        // ç®€æ´åŠŸèƒ½å®ç°ï¼šè¯„è®ºå¯å¸¦å•ä¸ªæ–‡ä»¶ï¼ˆPDF/PNG/JPEGï¼‰ï¼Œæ•°æ®ä¿å­˜åœ¨ localStorageï¼Œæ”¯æŒç¼–è¾‘/åˆ é™¤/å¯¼å‡º/å¯¼å…¥
        const commentsKey = 'ln_demo_comments_v1';
        const themeKey = 'ln_demo_theme_v1';

        // å…ƒç´ 
        const yearEl = document.getElementById('year');
        const addCommentBtn = document.getElementById('addComment');
        const commentsContainer = document.getElementById('commentsContainer');
        const filesGrid = document.getElementById('filesGrid');
        const exportBtn = document.getElementById('exportData');
        const importBtn = document.getElementById('importDataBtn');
        const importFile = document.getElementById('importFile');
        const editToggle = document.getElementById('editToggle');
        const heroText = document.getElementById('heroText');
        const siteTitle = document.getElementById('siteTitle');
        const deployTips = document.getElementById('deployTips');

        yearEl.textContent = new Date().getFullYear();

        // ä¸»é¢˜
        const themeToggle = document.getElementById('themeToggle');
        function setTheme(t) { document.body.setAttribute('data-theme', t); localStorage.setItem(themeKey, t); themeToggle.textContent = t === 'dark' ? 'æ—¥é—´' : 'å¤œé—´' }
        const savedTheme = localStorage.getItem(themeKey) || 'light'; setTheme(savedTheme);
        themeToggle.addEventListener('click', () => setTheme(document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'));
        document.getElementById('setLight').addEventListener('click', () => setTheme('light'));
        document.getElementById('setDark').addEventListener('click', () => setTheme('dark'));

        // æ•°æ®ç»“æ„ï¼š{id, name, email, text, ts, fileName?, fileType?, fileDataBase64?}
        function loadComments() { try { return JSON.parse(localStorage.getItem(commentsKey)) || [] } catch (e) { return [] } }
        function saveComments(list) { localStorage.setItem(commentsKey, JSON.stringify(list)) }

        function renderComments() {
            const list = loadComments();
            commentsContainer.innerHTML = '';
            filesGrid.innerHTML = '';
            if (list.length === 0) { commentsContainer.innerHTML = '<div class="muted">è¿˜æ²¡æœ‰è¯„è®ºï¼Œæˆä¸ºç¬¬ä¸€ä½ï¼</div>'; return }
            list.slice().reverse().forEach(c => {
                const el = document.createElement('div'); el.className = 'comment';
                el.innerHTML = `
              <div class="avatar">${escapeText(c.name || 'è®¿å®¢').slice(0, 2)}</div>
              <div class="comment-body">
                <div class="meta"><strong>${escapeText(c.name || 'è®¿å®¢')}</strong><div class="small">${new Date(c.ts).toLocaleString()}</div></div>
                <div style="margin-top:6px" data-id="${c.id}" class="cText">${escapeText(c.text)}</div>
                ${c.fileName ? `<a class="file-link" data-id="${c.id}">ğŸ“ ${escapeText(c.fileName)}</a>` : ''}
                <div class="actions" style="margin-top:8px">
                  <button class="ghost" data-action="edit" data-id="${c.id}">ç¼–è¾‘</button>
                  <button class="ghost" data-action="delete" data-id="${c.id}">åˆ é™¤</button>
                </div>
              </div>
            `;
                commentsContainer.appendChild(el);
            });

            // å¡«å……å³ä¾§æ–‡ä»¶åˆ—è¡¨
            const files = loadComments().filter(i => i.fileName);
            files.forEach(f => {
                const d = document.createElement('div'); d.className = 'file-thumb';
                d.innerHTML = `${escapeText(f.fileName)}<div style="margin-top:6px" class="small">${(f.fileType || '').toUpperCase()}</div><div style="margin-top:8px"><button class="ghost" data-fileid="${f.id}">é¢„è§ˆ/ä¸‹è½½</button></div>`;
                filesGrid.appendChild(d);
            });
        }

        // äº‹ä»¶ï¼šè¯„è®ºæäº¤
        addCommentBtn.addEventListener('click', async () => {
            const name = document.getElementById('cName').value.trim();
            const email = document.getElementById('cEmail').value.trim();
            const text = document.getElementById('cText').value.trim();
            const fileInput = document.getElementById('cFile');
            if (!name) return alert('è¯·å¡«å†™å§“å');
            if (!text) return alert('è¯·å¡«å†™è¯„è®ºå†…å®¹');

            const newItem = { id: 'c_' + Date.now(), name, email, text, ts: Date.now() };

            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];
                if (file.size > 5 * 1024 * 1024) { if (!confirm('æ–‡ä»¶å¤§äº 5MBï¼Œå»ºè®®ä¸Šä¼ è‡³äº‘å­˜å‚¨å†å¡«å…¥é“¾æ¥ã€‚ä»è¦ç»§ç»­ï¼Ÿ')) return }
                const data = await readFileAsBase64(file);
                newItem.fileName = file.name; newItem.fileType = file.type; newItem.fileData = data; // æ³¨æ„ï¼šlocalStorage æœ‰å¤§å°é™åˆ¶
            }

            const list = loadComments(); list.push(newItem); saveComments(list); renderComments();
            // æ¸…ç©ºè¡¨å•
            document.getElementById('cName').value = ''; document.getElementById('cEmail').value = ''; document.getElementById('cText').value = ''; document.getElementById('cFile').value = '';
        });

        // è¯»å– base64
        function readFileAsBase64(file) { return new Promise((res, rej) => { const fr = new FileReader(); fr.onload = () => res(fr.result); fr.onerror = rej; fr.readAsDataURL(file) }) }

        // äº‹ä»¶å§”æ‰˜ï¼šç¼–è¾‘/åˆ é™¤/é¢„è§ˆ
        commentsContainer.addEventListener('click', async (e) => {
            const btn = e.target.closest('button');
            const link = e.target.closest('.file-link');
            if (link) { const id = link.getAttribute('data-id'); openFileById(id); return }
            if (!btn) return;
            const action = btn.getAttribute('data-action');
            const id = btn.getAttribute('data-id');
            if (action === 'delete') {
                if (!confirm('ç¡®å®šåˆ é™¤è¯¥è¯„è®ºï¼Ÿ')) return;
                const list = loadComments().filter(i => i.id !== id); saveComments(list); renderComments();
            } else if (action === 'edit') {
                const list = loadComments(); const item = list.find(i => i.id === id); if (!item) return;
                const newText = prompt('ç¼–è¾‘è¯„è®ºå†…å®¹ï¼š', item.text); if (newText == null) return; item.text = newText; saveComments(list); renderComments();
            }
        });

        filesGrid.addEventListener('click', (e) => {
            const btn = e.target.closest('button'); if (!btn) return; const id = btn.getAttribute('data-fileid'); openFileById(id);
        });

        function openFileById(id) { const item = loadComments().find(i => i.id === id); if (!item || !item.fileData) { alert('æœªæ‰¾åˆ°é™„ä»¶æˆ–è¯¥é™„ä»¶è¾ƒå¤§æ— æ³•æœ¬åœ°é¢„è§ˆ'); return } const w = window.open(); w.document.title = item.fileName; if (item.fileType.startsWith('image/')) { w.document.body.style.margin = '0'; const img = w.document.createElement('img'); img.src = item.fileData; img.style.maxWidth = '100%'; img.style.display = 'block'; w.document.body.appendChild(img); } else { const link = w.document.createElement('a'); link.href = item.fileData; link.download = item.fileName; link.textContent = 'ä¸‹è½½ ' + item.fileName; w.document.body.appendChild(link); } }

        // å¯¼å‡º/å¯¼å…¥
        exportBtn.addEventListener('click', () => {
            const payload = {
                meta: { exportedAt: new Date().toISOString(), title: siteTitle.textContent.trim(), hero: heroText.innerHTML },
                comments: loadComments()
            };
            const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'site-backup.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        });

        importBtn.addEventListener('click', () => importFile.click());
        importFile.addEventListener('change', async (e) => {
            const f = e.target.files[0]; if (!f) return; try { const txt = await f.text(); const data = JSON.parse(txt); if (data.meta) { if (confirm('å¯¼å…¥å°†è¦†ç›–å½“å‰è¯„è®ºï¼Œç»§ç»­ï¼Ÿ')) { if (Array.isArray(data.comments)) { saveComments(data.comments); renderComments(); } if (data.meta.title) siteTitle.textContent = data.meta.title; if (data.meta.hero) heroText.innerHTML = data.meta.hero; alert('å¯¼å…¥å®Œæˆ') } } else alert('æœªæ£€æµ‹åˆ°æœ‰æ•ˆå¤‡ä»½æ–‡ä»¶'); } catch (err) { alert('å¯¼å…¥å¤±è´¥ï¼š' + err.message) } finally { importFile.value = '' }
        });

        // ç¼–è¾‘æ¨¡å¼ï¼šåˆ‡æ¢ contenteditable çš„è¾¹æ¡†æç¤º
        let editMode = false; editToggle.addEventListener('click', () => {
            editMode = !editMode; editToggle.textContent = editMode ? 'é€€å‡ºç¼–è¾‘' : 'ç¼–è¾‘é¡µé¢';
            [siteTitle, heroText].forEach(el => el.contentEditable = editMode);
            if (editMode) { siteTitle.style.outline = '2px dashed rgba(37,99,235,0.18)'; heroText.style.outline = '2px dashed rgba(37,99,235,0.08)'; } else { siteTitle.style.outline = ''; heroText.style.outline = ''; }
        });

        // éƒ¨ç½²è¯´æ˜å¼¹çª—
        deployTips.addEventListener('click', () => {
            const msg = `éƒ¨ç½²å»ºè®®ï¼š\n\n1) GitHub Pagesï¼ˆå…è´¹ï¼Œé€‚åˆé™æ€ç«™ç‚¹ï¼‰\n - åœ¨ GitHub åˆ›å»ºä¸€ä¸ªä»“åº“ï¼ŒæŠŠæœ¬æ–‡ä»¶ï¼ˆindex.htmlï¼‰ä»¥åŠé™æ€èµ„æºæ¨é€åˆ°ä»“åº“\n - åœ¨ä»“åº“è®¾ç½®ä¸­å¯ç”¨ Pagesï¼Œé€‰æ‹© main åˆ†æ”¯çš„ /root å°±èƒ½è·å¾—è®¿é—®åœ°å€\n\n2) Netlify / Vercelï¼ˆè‡ªåŠ¨åŒ–éƒ¨ç½² + CDNï¼‰\n - åœ¨ Netlify/Vercel æ³¨å†Œå¹¶è¿æ¥ä½ çš„ GitHub ä»“åº“ï¼Œå®ƒä»¬ä¼šåœ¨æ¯æ¬¡æ¨é€æ—¶è‡ªåŠ¨éƒ¨ç½²\n - æ”¯æŒè‡ªå®šä¹‰åŸŸåã€HTTPS ä¸ç®€å•çš„è¡¨å•åç«¯ï¼ˆå¯æ¥ç¬¬ä¸‰æ–¹åç«¯æˆ– serverless å‡½æ•°ï¼‰\n\n3) è‹¥éœ€è¦å…¨ç«™è¯„è®ºé›†ä¸­å­˜å‚¨ï¼Œè¯·æ¥å…¥åç«¯ï¼ˆä¾‹å¦‚ Firebase Storage / Firestore æˆ–è‡ªå»º APIï¼‰ä»¥æ›¿ä»£æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ã€‚\n\næˆ‘ä¹Ÿå¯ä»¥ç»™å‡ºæ›´è¯¦ç»†çš„é€æ­¥éƒ¨ç½²æŒ‡å¼•ï¼ˆä¾‹å¦‚ Git å‘½ä»¤æˆ– Netlify é…ç½®ï¼‰ã€‚`;
            alert(msg);
        });

        // å°å·¥å…·ï¼šè½¬ä¹‰æ–‡æœ¬ä»¥é˜² XSSï¼ˆç®€å•å¤„ç†ï¼Œå·²ä¿ç•™æ¢è¡Œï¼‰
        function escapeText(t) { if (!t) return ''; return String(t).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>'); }

        // åˆå§‹æ¸²æŸ“
        renderComments();

    </script>
</body>
</html>
